
<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kalkulator inwestycji BTC z inflacją</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label, input, button { font-size: 1rem; margin-top: 0.5em; }
  input, button { padding: 0.3em; }
  #result { margin-top: 1em; white-space: pre-line; font-weight: bold; }
  #dateLabel, #investmentDate { display: none; }
  #inflationNote { color: #a00; font-size: 0.9rem; }
</style>
</head>
<body>
<h1>Kalkulator inwestycji BTC z uwzględnieniem inflacji</h1>

<label for="pln">Kwota inwestycji w PLN:</label><br />
<input type="number" id="pln" min="0" step="0.01" /><br />

<label for="btc">Ilość zakupionego BTC:</label><br />
<input type="number" id="btc" min="0" step="0.00000001" /><br />

<label><input type="checkbox" id="useInflation" /> Uwzględnij inflację</label><br />

<label for="investmentDate" id="dateLabel">Data inwestycji (rok-miesiąc):</label><br />
<input type="month" id="investmentDate" /><br />

<div id="inflationNote"></div>

<button id="calcBtn">Oblicz wartość</button>
<button id="saveBtn">Zapisz inwestycję lokalnie</button>
<button id="refreshBtn">Resetuj formularz</button>

<div id="result"></div>

<script>
  const monthlyCPI = {
    "2000-01": 56.8,
    "2000-02": 57.1,
    "2000-03": 57.3,
    "2000-04": 57.5,
    "2000-05": 57.6,
    "2000-06": 57.8,
    "2021-12": 107.1,
    "2022-01": 110.3,
    "2022-12": 125.0,
    "2023-01": 126.5,
    "2023-12": 133.0,
    "2024-01": 134.0,
    "2024-12": 140.0,
    "2025-01": 141.0,
    "2025-04": 142.0
  };

  function setMaxDate() {
    const input = document.getElementById("investmentDate");
    const today = new Date();
    let mm = (today.getMonth() + 1).toString().padStart(2, "0");
    let yyyy = today.getFullYear();
    input.max = `${yyyy}-${mm}`;
    if (!input.value) input.value = `${yyyy}-${mm}`;
  }

  setMaxDate();

  document.getElementById("useInflation").addEventListener("change", function () {
    const show = this.checked;
    document.getElementById("dateLabel").style.display = show ? "block" : "none";
    document.getElementById("investmentDate").style.display = show ? "block" : "none";
  });

  function calculateInflationFactor(dateString) {
    const sortedDates = Object.keys(monthlyCPI).sort();
    const oldestDate = sortedDates[0];
    const latestDate = sortedDates[sortedDates.length - 1];
    const noteElem = document.getElementById("inflationNote");

    if (dateString < oldestDate) {
      noteElem.textContent = `Dane CPI dostępne od ${oldestDate}, inflacja liczona od tej daty.`;
      return monthlyCPI[latestDate] / monthlyCPI[oldestDate];
    }

    let closestDate = null;
    for (let i = sortedDates.length - 1; i >= 0; i--) {
      if (sortedDates[i] <= dateString) {
        closestDate = sortedDates[i];
        break;
      }
    }

    noteElem.textContent = "";
    return monthlyCPI[latestDate] / monthlyCPI[closestDate];
  }

  async function calculateBTCValue() {
    const plnStr = document.getElementById("pln").value.replace(",", ".");
    const btcStr = document.getElementById("btc").value.replace(",", ".");
    const pln = parseFloat(plnStr);
    const btc = parseFloat(btcStr);
    const useInflation = document.getElementById("useInflation").checked;
    const date = document.getElementById("investmentDate").value;

    if (isNaN(pln) || pln <= 0) {
      alert("Podaj poprawną kwotę inwestycji w PLN.");
      return;
    }
    if (isNaN(btc) || btc <= 0) {
      alert("Podaj poprawną ilość BTC.");
      return;
    }

    let inflationFactor = 1;
    if (useInflation) {
      if (!date) {
        alert("Podaj datę inwestycji.");
        return;
      }
      inflationFactor = calculateInflationFactor(date);
    }

    try {
      const response = await fetch(
        "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=pln"
      );
      const data = await response.json();
      const currentBTCPLN = data.bitcoin.pln;

      const currentValueBTC = btc * currentBTCPLN;
      const inflationAdjustedPLN = pln * inflationFactor;
      const profitLoss = currentValueBTC - inflationAdjustedPLN;

      const result = `
Aktualna wartość BTC: ${currentValueBTC.toFixed(2)} PLN
Wartość inwestycji po uwzględnieniu inflacji: ${inflationAdjustedPLN.toFixed(2)} PLN
Zysk/Strata: ${profitLoss.toFixed(2)} PLN
Inflacja od daty inwestycji: ${(inflationFactor * 100 - 100).toFixed(2)}%
      `;

      document.getElementById("result").textContent = result.trim();
    } catch (e) {
      document.getElementById("result").textContent =
        "Błąd pobierania aktualnego kursu BTC.";
    }
  }

  document.getElementById("calcBtn").addEventListener("click", calculateBTCValue);
  document.getElementById("refreshBtn").addEventListener("click", () => location.reload());

  document.getElementById("saveBtn").addEventListener("click", () => {
    const pln = document.getElementById("pln").value;
    const btc = document.getElementById("btc").value;
    const useInflation = document.getElementById("useInflation").checked;
    const date = document.getElementById("investmentDate").value;
    localStorage.setItem("bitpln_invest", JSON.stringify({ pln, btc, useInflation, date }));
    alert("Inwestycja zapisana lokalnie!");
  });

  window.addEventListener("load", () => {
    const saved = localStorage.getItem("bitpln_invest");
    if (saved) {
      try {
        const { pln, btc, useInflation, date } = JSON.parse(saved);
        document.getElementById("pln").value = pln;
        document.getElementById("btc").value = btc;
        document.getElementById("useInflation").checked = useInflation;
        if (useInflation) {
          document.getElementById("dateLabel").style.display = "block";
          document.getElementById("investmentDate").style.display = "block";
          document.getElementById("investmentDate").value = date;
        }
      } catch {}
    }
  });
</script>
</body>
</html>
