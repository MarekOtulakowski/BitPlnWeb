
<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BitPLN</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #121212;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    input, button, select {
      margin: 8px 0;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background-color: #1e88e5;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #1565c0;
    }
    .card {
      background-color: #1f1f1f;
      padding: 30px 24px;
      border-radius: 16px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      box-sizing: border-box;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
    }
    #result {
      white-space: pre-wrap;
      margin-top: 20px;
      font-size: 1.1rem;
    }
    #profitLoss {
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>BitPLN</h1>
    <label for="pln">Kwota inwestycji (PLN):</label>
    <input type="number" id="pln" step="0.01" placeholder="np. 1000" />
    
    <label for="btc">Wartość BTC w chwili zakupu:</label>
    <input type="number" step="0.00000001" id="btc" placeholder="np. 0.01" />
    
    <label for="country">Kraj:</label>
    <select id="country">
      <option value="PL">Polska</option>
    </select>
    
    <label><input type="checkbox" id="useInflation" /> Uwzględnij inflację</label>
    <label id="dateLabel" style="display:none">Data inwestycji:
      <input type="month" id="investmentDate" />
    </label>
    
    <button onclick="calculateBTCValue()">Oblicz wartość BTC</button>
    <button onclick="saveInvestment()">Zapisz inwestycję</button>
    <button onclick="location.reload()">Odśwież stronę</button>
    
    <p id="result"></p>
    <p id="profitLoss"></p>
  </div>

  <script>
    document.getElementById("useInflation").addEventListener("change", function () {
      document.getElementById("dateLabel").style.display = this.checked ? "block" : "none";
    });

    async function calculateInflationFactor(dateString) {
      const monthlyFactors = {
        "2021-12": 1.00,
        "2022-01": 1.03, "2022-12": 1.17,
        "2023-12": 1.24,
        "2024-12": 1.30,
        "2025-04": 1.35
      };

      // Sort keys to find closest lower bound if date not exact
      const keys = Object.keys(monthlyFactors).sort();
      if (!dateString) return 1.0;
      for (let i = keys.length - 1; i >= 0; i--) {
        if (dateString >= keys[i]) {
          return monthlyFactors[keys[i]];
        }
      }
      return 1.0; // If date too early, no inflation data
    }

    async function calculateBTCValue() {
      const plnInput = document.getElementById("pln").value.replace(',', '.');
      const btcInput = document.getElementById("btc").value.replace(',', '.');
      const pln = parseFloat(plnInput);
      const btc = parseFloat(btcInput);
      const useInflation = document.getElementById("useInflation").checked;
      const date = document.getElementById("investmentDate").value;

      if (isNaN(pln) || isNaN(btc) || pln <= 0 || btc <= 0) {
        document.getElementById("result").textContent = "Wprowadź poprawne, dodatnie dane.";
        document.getElementById("profitLoss").textContent = "";
        return;
      }

      let inflationFactor = 1.0;
      if (useInflation && date) {
        inflationFactor = await calculateInflationFactor(date);
      }

      try {
        const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=pln,usd");
        if (!res.ok) throw new Error("HTTP error " + res.status);

        const data = await res.json();
        const currentRatePLN = data.bitcoin.pln;
        const currentRateUSD = data.bitcoin.usd;

        const currentValuePLN = btc * currentRatePLN;
        const currentValueUSD = btc * currentRateUSD;
        const adjustedInitialValue = pln * inflationFactor;
        const profitLoss = currentValuePLN - adjustedInitialValue;

        document.getElementById("result").textContent =
          `Wartość BTC dzisiaj: ${currentValuePLN.toFixed(2)} PLN (${currentValueUSD.toFixed(2)} USD)
` +
          `Zmieniona wartość inwestycji (uwzględniając inflację): ${adjustedInitialValue.toFixed(2)} PLN`;

        const profitLossElem = document.getElementById("profitLoss");
        profitLossElem.textContent = `Zysk / Strata: ${profitLoss.toFixed(2)} PLN`;
        if (profitLoss >= 0) {
          profitLossElem.style.color = "#4caf50"; // zielony
        } else {
          profitLossElem.style.color = "#f44336"; // czerwony
        }
      } catch (e) {
        document.getElementById("result").textContent = "Nie udało się pobrać kursu BTC. Sprawdź połączenie internetowe.";
        document.getElementById("profitLoss").textContent = "";
      }
    }

    function saveInvestment() {
      const data = {
        pln: document.getElementById("pln").value,
        btc: document.getElementById("btc").value,
        country: document.getElementById("country").value,
        useInflation: document.getElementById("useInflation").checked,
        investmentDate: document.getElementById("investmentDate").value
      };
      localStorage.setItem("bitplnInvestment", JSON.stringify(data));
      alert("Inwestycja została zapisana.");
    }

    function loadInvestment() {
      const saved = localStorage.getItem("bitplnInvestment");
      if (!saved) return;
      const data = JSON.parse(saved);
      document.getElementById("pln").value = data.pln || "";
      document.getElementById("btc").value = data.btc || "";
      document.getElementById("country").value = data.country || "PL";
      document.getElementById("useInflation").checked = data.useInflation;
      if (data.useInflation) {
        document.getElementById("dateLabel").style.display = "block";
        document.getElementById("investmentDate").value = data.investmentDate || "";
      }
    }

    window.onload = loadInvestment;
  </script>
</body>
</html>
